# Setup Development Environment

## Clone Repository

```shell
git clone https://github.com/openaurae/openaurae.git
```

## Install Dependencies

First, install [Bun](https://bun.sh/) which serves as both package manager and runtime.

```shell
bun install
```

## Setup Database

Start a [ScyllaDB](https://www.scylladb.com/) database using Docker with the following command:

```shell
docker run -d \
    --name scylla \
    -p 9042:9042 \
    --restart unless-stopped \
    scylladb/scylla --smp 1 --memory=750M
```

If you prefer a local installation instead of Docker, follow the [ScyllaDB installation guide](https://opensource.docs.scylladb.com/stable/getting-started/install-scylla/).

## Setup MQTT Broker

Start an MQTT broker using Docker:

```shell
docker run -d \
  --name openaurae-mq \
  -p 1883:1883 \
  --restart unless-stopped \
  eclipse-mosquitto
```

Set up [authentication](https://mosquitto.org/documentation/authentication-methods/) by creating a password file. 
We'll use the username `openaurae` with password `development`:

```shell
# content is generated by mosquitto_passwd -c <password file> <username>
docker exec openaurae-mq sh -c "echo 'openaurae:$7$101$S8Xhm3wclCvngUNf$s7v1lTxy23x5iIEaeyS0W66zYbJDWZwwHQbmpLO0ZlX750kVcS7c3Gp/x41A9nZiaRBw5uz4xiFcWi3OEJWK4A==' > /mosquitto/config/password_file"
```

Test your MQTT connection using a client like [MQTTX](https://mqttx.app/)
or [mqtt-cli](https://hivemq.github.io/mqtt-cli/):

```shell
# In one shell, subscribe to the zigbee topic
mqtt sub -t zigbee/# -h localhost -p 1883 -u openaurae -pw development

# In another shell, publish a test message
mqtt pub -t zigbee/dev1 -h localhost -p 1883 -u openaurae -pw development \
  -m '{"device_id": "dev1"}'
```

## Start Backed Server

The backend requires several environment variables. Create a `.env.development` file in the `server` directory:

```shell
cat <<EOF > packages/server/.env.development
# Clerk API keys (auth)
CLERK_PUBLISHABLE_KEY=pk_test_???
CLERK_SECRET_KEY=sk_test_???

# Database
CASSANDRA_HOST=127.0.0.1
CASSANDRA_KEYSPACE=aurae

# MQTT broker
MQTT_PROTOCOL=mqtt
MQTT_URL=mqtt://127.0.0.1:1883
MQTT_USERNAME=openaurae
MQTT_PASSWORD=development

# NEMo cloud
NEMO_URL=https://www.nemocloud.com
NEMO_OPERATOR=admin
NEMO_PASSWORD=???
NEMO_COMPANY=???

# NEMo cloud S5
NEMO_S5_URL=https://s5.nemocloud.com
NEMO_S5_OPERATOR=Admin
NEMO_S5_PASSWORD=???
NEMO_S5_COMPANY=???
EOF
```

Replace the `???` placeholders with actual values:

- For Clerk API keys: log in to the [Clerk dashboard](https://dashboard.clerk.com/) using the Google account
`openaurae.org@gmail.com`.
Select the **Development** environment of the OpenAurae application and go to `Configure > API keys`
- For NEMo cloud accounts: please contact the lab manager

Start the backend server:

```shell
cd packages/server && bun run dev
```

## Start Frontend Dev Server

Create a `.env.development` file in the `website` directory with Clerk public key and backend URL:

```shell
cat <<EOF > packages/website/.env.development
# Clerk API pub key
VITE_CLERK_PUBLISHABLE_KEY=pk_test_???

# Backend server URL
VITE_API_BASE_URL='http://127.0.0.1:8000'
EOF
```

Start the frontend development server:

```shell
cd packages/website && bun run dev
```
